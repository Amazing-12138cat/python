import requests
import base64
from lxml import etree
search = '"dvwa"'
#search = '"glassfish" && port="4848" && country="CN"'
page = 2
headers={
    'user-agent':'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36',
    'cookie':'Hm_lvt_b5514a35664fd4ac6a893a1e56956c97=1647247972; isUpgrade=; befor_router=; fofa_token=eyJhbGciOiJIUzUxMiIsImtpZCI6Ik5XWTVZakF4TVRkalltSTJNRFZsWXpRM05EWXdaakF3TURVMlkyWTNZemd3TUdRd1pUTmpZUT09IiwidHlwIjoiSldUIn0.eyJpZCI6NjM1ODQsIm1pZCI6MTAwMDQwOTU0LCJ1c2VybmFtZSI6ImhhcHB5Y2F0IiwiZXhwIjoxNjQ4MDQzODM5LjI2NDg2OH0.8vrBpOGr0Hp_Ys-Fwefdr-tVnaU7ZPfLFPtjZOKgEs8Dd6CASdRUxIhmpfjWBI6V2rfIUfqpT9QSLeaVAhPKqQ; user={"id":63584,"mid":100040954,"is_admin":false,"username":"happycat","nickname":"","email":"18847140275@163.com","avatar_medium":"https://nosec.org/missing.jpg","avatar_thumb":"https://nosec.org/missing.jpg","rank_name":"高级会员","rank_level":2,"company_name":"","coins":0,"can_pay_coins":0,"credits":851,"expiration":"-","login_at":1647247990}; refresh_token=eyJhbGciOiJIUzUxMiIsImtpZCI6Ik5XWTVZakF4TVRkalltSTJNRFZsWXpRM05EWXdaakF3TURVMlkyWTNZemd3TUdRd1pUTmpZUT09IiwidHlwIjoiSldUIn0.eyJpZCI6NjM1ODQsIm1pZCI6MTAwMDQwOTU0LCJ1c2VybmFtZSI6ImhhcHB5Y2F0IiwiZXhwIjoxNjQ4MjU5ODM5LjI2NDg2OCwiaXNzIjoicmVmcmVzaCJ9.3Qo37hqpXvQd_PtqIXXmQsHy_JIAsjlrb8KlbWJ7W8w_JVd1ic0qgvPfk89yiR4HZqZletyHsXP5wwKw_orwgg; Hm_lpvt_b5514a35664fd4ac6a893a1e56956c97=1648002985'.encode("utf-8")
}
keyword = str(base64.b64encode(search.encode("utf-8")),"utf-8")
url = 'https://fofa.info/result?qbase64='+keyword+'&page='+str(page)+'&page_size=20'
try:
    resp = requests.post(url,headers=headers,timeout=1).content
    #print(resp.decode('utf-8'))
    soup = etree.HTML(resp)
    result = soup.xpath('//span[@class="aSpan"]/a[@target="_blank"]/@href')
    print(result)
    result1 = '\n'.join(result)
    print(result1)
except Exception as e:
    print(e)
